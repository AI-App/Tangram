set -e
npm install
wasm-bindgen \
  --target bundler \
  --out-dir wasm/dist/bundler \
  wasm/dist/tangram_wasm.wasm
wasm-bindgen \
  --target nodejs \
  --out-dir wasm/dist/node \
  wasm/dist/tangram_wasm.wasm
mv wasm/dist/node/tangram_wasm.js wasm/dist/node/tangram_wasm.cjs
npx tsc --module commonjs
mv common.js common.cjs
mv common.js.map common.cjs.map
npx tsc
sed -i '1s/^/\/\/\/ <reference types=".\/common.d.ts" \/>\n/' common.js
npm publish --access public
